# AGENTS.md

This file provides guidance to AI agents (Claude Code, Cursor, Copilot, etc.) when working with code in this repository.

## What This Is

**typedoc-plugin-llms-txt** is a TypeDoc plugin that generates [`llms.txt`](https://llmstxt.org/) files—LLM-friendly documentation summaries—from TypeDoc output.

**Purpose**: Automatically produce machine-readable documentation summaries that help LLMs understand your library's API and docs.

**Key Features**:

- Zero-config defaults with sensible fallbacks
- Auto-discovers sections from project document frontmatter (`category` field)
- Auto-generates API links from TypeDoc entry points
- Custom template support with slot-based rendering
- Configurable header, sections, declarations, and quick reference

## Quick Start

```bash
npm install              # Install dependencies
npm test                 # Run tests with node:test
npm run build            # Build ESM + CJS output
npm run lint             # Check all linters (parallel)
```

## Project Structure

```text
typedoc-plugin-llms-txt/
├── src/
│   ├── index.ts         # Plugin entry point (load function), re-exports
│   ├── generator.ts     # Core content generation (sections, declarations, rendering)
│   ├── options.ts       # TypeDoc option declarations and getters
│   └── template.ts      # Custom template parsing and slot replacement
├── test/
│   └── index.test.ts    # Tests (placeholder)
├── dist/                # Build output (ESM .js, CJS .cjs, declarations)
├── eslint.config.js     # ESLint v9+ flat config
└── tsconfig.json        # TypeScript strict mode config
```

## Architecture

### Plugin Entry Point (`src/index.ts`)

The `load(app)` function registers TypeDoc options and hooks into `RendererEvent.END` to generate `llms.txt` after docs render.

**Key flow**:

1. Register options via `declareOptions(app)`
2. On render end: gather project documents, resolve paths
3. Build content: header, sections (from frontmatter), declarations (from entry points or config)
4. Render via default renderer or custom template
5. Write output file

### Options (`src/options.ts`)

Declares TypeDoc options and provides typed getter:

| Option                  | Type      | Default      | Description                          |
| ----------------------- | --------- | ------------ | ------------------------------------ |
| `llmsTxt`               | `boolean` | `true`       | Enable/disable generation            |
| `llmsTxtFilename`       | `string`  | `"llms.txt"` | Output filename                      |
| `llmsTxtHeader`         | `object`  | `{}`         | `{ name?, description?, features? }` |
| `llmsTxtSections`       | `object`  | `{}`         | Category → `{ displayName, order }`  |
| `llmsTxtDeclarations`   | `array`   | `[]`         | `[{ ref, label, description? }]`     |
| `llmsTxtQuickReference` | `string`  | `""`         | Code examples block                  |
| `llmsTxtTemplate`       | `path`    | `undefined`  | Custom template file path            |

### Generator (`src/generator.ts`)

Core content generation logic:

- **`extractFrontmatter()`** - Parses YAML frontmatter from markdown (title, category)
- **`discoverSections()`** - Groups documents by category from frontmatter
- **`autoGenerateDeclarations()`** - Creates API links from TypeDoc entry points
- **`resolveDeclarations()`** - Resolves user-provided declaration references (e.g., `myproject!myFunction`)
- **`renderLlmsTxt()`** - Default renderer producing markdown output
- **`titleToUrlPath()`** - Converts titles to TypeDoc's URL format (`@` → `-I_`, `/` → `_`, ` ` → `_`)

### Template (`src/template.ts`)

Custom template support with slot replacement:

- **Slots**: `{{header}}`, `{{sections}}`, `{{section:CategoryName}}`, `{{declarations}}`, `{{quickReference}}`
- **`findSlots()`** - Discovers slots in template
- **`applyTemplate()`** - Replaces slots with rendered content

## Key Patterns

### TypeDoc Plugin API

This plugin uses TypeDoc's plugin system:

```typescript
import { type Application, RendererEvent } from 'typedoc';

export const load = (app: Application): void => {
  // Register options
  app.options.addDeclaration({ name: '...', type: ParameterType.Boolean, ... });

  // Hook into render lifecycle
  app.renderer.on(RendererEvent.END, (event) => {
    const project = event.project;
    const outputDir = app.options.getValue('out');
    // Generate llms.txt
  });
};
```

### Declaration References

Declaration refs use TypeDoc's format:

- `myproject!` - Module reference
- `myproject!myFunction` - Symbol reference
- `myproject!MyClass.method` - Nested symbol

The resolver navigates the TypeDoc reflection tree to generate URLs.

### Testing (node:test + bupkis)

```typescript
import { describe, it } from 'node:test';
import { expect } from 'bupkis';

describe('discoverSections', () => {
  it('should group documents by category', () => {
    const sections = discoverSections(paths, config, baseUrl);
    expect(sections, 'to have length', 2);
  });
});
```

**Test files**: `test/**/*.test.ts`
**Run with**: `npm test` or `npm run test:watch`

## Dependencies

### Peer Dependency

- **typedoc** `^0.28.0` - Required; this plugin hooks into TypeDoc's renderer

### Development Only

- Standard tooling: TypeScript, ESLint, Prettier, bupkis (assertions)
- No production dependencies (plugin code uses only Node.js built-ins + TypeDoc API)

## Common Tasks

### Adding a New Option

1. Add interface in `src/options.ts` if needed
2. Add `app.options.addDeclaration()` in `declareOptions()`
3. Add to return type and implementation in `getOptions()`
4. Use in `src/index.ts` render handler

### Modifying Default Output Format

Edit `renderLlmsTxt()` in `src/generator.ts`. The function builds markdown line-by-line.

### Adding a New Template Slot

1. Add slot type to `TemplateSlot` union in `src/template.ts`
2. Add case to `renderSlot()` switch statement
3. Document in README.md

### Testing with a Real Project

```bash
# In another project with TypeDoc configured:
npm link /path/to/typedoc-plugin-llms-txt
# Add 'typedoc-plugin-llms-txt' to typedoc.config.js plugins
npx typedoc
# Check output directory for llms.txt
```

## Code Style

- Semicolons required, single quotes, 2-space indentation
- Arrow functions for callbacks, function expressions over declarations
- Inline type imports: `import { type Foo } from 'bar'`
- Unused variables start with `_`
- All exports have JSDoc docstrings

## Common Pitfalls

1. **TypeDoc version mismatch**: Requires `typedoc` v0.28.0+; API may differ from older versions
2. **URL generation**: TypeDoc's URL format has quirks (special char escaping); see `titleToUrlPath()` and `nameToUrlPath()`
3. **Frontmatter parsing**: Uses simple regex, not a full YAML parser; handles quoted strings but not complex YAML
4. **Declaration resolution**: If refs don't resolve, check module/symbol names match exactly
5. **Template slots**: Must match exact pattern `{{slotName}}`; spaces or typos break replacement

## Quick Reference

| Task       | Command              |
| ---------- | -------------------- |
| Install    | `npm install`        |
| Build      | `npm run build`      |
| Test       | `npm test`           |
| TDD        | `npm run test:watch` |
| Lint       | `npm run lint`       |
| Fix        | `npm run fix`        |
| Type check | `npm run lint:types` |

## Resources

- **llms.txt specification**: https://llmstxt.org/
- **TypeDoc Plugin Guide**: https://typedoc.org/guides/development/#plugins
- **TypeDoc API Reference**: https://typedoc.org/api/
- **bupkis assertions**: https://github.com/boneskull/bupkis
